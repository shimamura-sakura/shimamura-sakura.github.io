<!DOCTYPE html>
<html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>云蒙梦 - 加密/解密</title>

<body>
  <button onclick="io.value=YMM.decode(io.value)">解密</button>
  <button onclick="io.value=YMM.encode(io.value)">加密</button>
  <br />
  <textarea id="io" style="width: 80em; height: 20em"></textarea>
  <script>
    const YMM = (() => {
      const segre = /(\\(?:\d+-\d+\|){4})/g;
      const mactl = [['\\', "cC;':[]+"], ['|', "mM,./?><"], ['-', "~※♥♣♠√×♦"]];
      const manum = "xX)↕ĸŒɑ;uU!←bØÆ;dD@→āæĲ;tT#↖ðĊį;kK$↗ċďĤ;rR%↑ĝÉĢ;sS^↙ĘĞË;wW&↘ĮĥĎ;oO*↔ĦÏç;nN(↓ÕĶB";
      const moabc = '2-2;4-7;4-5;3-3;1-1;4-13;3-1;4-15;2-3;4-8;3-2;4-11;2-0;2-1;3-0;4-9;4-2;3-5;3-7;1-0;4-14;5-28;3-4;4-6;4-4;4-3';
      const monum = '5-0;6-32;6-48;6-56;6-60;5-31;5-15;5-7;5-3;5-1';
      const dma = {}, dmo = {}, ema = {}, emo = {};
      const oneOf = cs => () => cs[Math.round(Math.random() * cs.length)];
      mactl.forEach(([t, [...cs]]) => cs.forEach(c => ema[dma[c] = t] = oneOf(cs)));
      manum.split(';').forEach(([...cs], i) => cs.forEach(c => ema[dma[c] = `${i}`] = oneOf(cs)));
      moabc.split(';').forEach((s, i) => emo[dmo[s] = String.fromCodePoint(97 + i)] = s);
      monum.split(';').forEach((s, i) => emo[dmo[s] = String.fromCodePoint(48 + i)] = s);
      return {
        decode: (s) => [...s].map(c => dma[c] ?? c).join('').split(segre).map(t =>
          t[0] != '\\' ? t : String.fromCodePoint(parseInt(t.slice(1, -1)
            .split('|').map(t => dmo[t] ?? '0').join(''), 16))).join(''),
        encode: (s) => [...s].flatMap(c => ' \n\r\t'.indexOf(c) >= 0 ? c :
          ['\\', ...[...c.codePointAt(0).toString(16).padStart(4, '0')]
            .map(d => emo[d]).join('|'), '|'].map(c => ema[c]?.() ?? c)).join('')
      };
    })();
  </script>
</body>

</html>